{"version":3,"sources":["api/mustread/mustread.controller.js"],"names":["get","add","remove","handleError","res","statusCode","err","console","log","status","send","req","findOne","userId","user","_id","populate","exec","then","json","mustread","catch","bookId","body","message","books","indexOf","push","save","newMustread","end","params","id","index","splice"],"mappings":"AAAA;;;;;QAegBA,G,GAAAA,G;QAaAC,G,GAAAA,G;QAgCAC,M,GAAAA,M;;AA1DhB;;;;;;AAEA,SAASC,WAAT,CAAqBC,GAArB,EAA0BC,UAA1B,EAAsC;AACpCA,eAAaA,cAAc,GAA3B;AACA,SAAO,UAASC,GAAT,EAAc;AACnBC,YAAQC,GAAR,CAAYF,GAAZ;AACA,WAAOF,IAAIK,MAAJ,CAAWJ,UAAX,EAAuBK,IAAvB,CAA4BJ,GAA5B,CAAP;AACD,GAHD;AAID;;AAED;;;AAGO,SAASN,GAAT,CAAaW,GAAb,EAAkBP,GAAlB,EAAuB;AAC5B,SAAO,mBAASQ,OAAT,CAAiB,EAAEC,QAAQF,IAAIG,IAAJ,CAASC,GAAnB,EAAjB,EACJC,QADI,CACK,OADL,EAEJC,IAFI,GAGJC,IAHI,CAGC,oBAAY;AAChBd,QAAIe,IAAJ,CAASC,QAAT;AACD,GALI,EAMJC,KANI,CAMElB,YAAYC,GAAZ,CANF,CAAP;AAOD;;AAED;;;AAGO,SAASH,GAAT,CAAaU,GAAb,EAAkBP,GAAlB,EAAuB;AAC5B,MAAMkB,SAASX,IAAIY,IAAJ,CAASD,MAAxB;AACA,MAAG,CAACA,MAAJ,EAAY;AACV,WAAOlB,IAAIK,MAAJ,CAAW,GAAX,EAAgBU,IAAhB,CAAqB,EAAEK,SAAS,mBAAX,EAArB,CAAP;AACD;;AAED,SAAO,mBAASZ,OAAT,CAAiB,EAAEC,QAAQF,IAAIG,IAAJ,CAASC,GAAnB,EAAjB,EAA2CE,IAA3C,GACJC,IADI,CACC,oBAAY;AAChB,QAAGE,QAAH,EAAa;AACX,UAAGA,SAASK,KAAT,CAAeC,OAAf,CAAuBJ,MAAvB,IAAiC,CAAC,CAArC,EAAwC;AACtC,eAAOlB,IAAIK,MAAJ,CAAW,GAAX,EAAgBU,IAAhB,CAAqB,EAAEK,SAAS,qCAAX,EAArB,CAAP;AACD;;AAEDJ,eAASK,KAAT,CAAeE,IAAf,CAAoBL,MAApB;AACA,aAAOF,SAASQ,IAAT,EAAP;AACD,KAPD,MAOO;AACL,UAAIC,cAAc,uBAAa;AAC7BhB,gBAAQF,IAAIG,IAAJ,CAASC,GADY;AAE7BU,eAAO,CAACH,MAAD;AAFsB,OAAb,CAAlB;AAIA,aAAOO,YAAYD,IAAZ,EAAP;AACD;AACF,GAhBI,EAiBJV,IAjBI,CAiBC,YAAM;AACVd,QAAI0B,GAAJ;AACD,GAnBI,EAoBJT,KApBI,CAoBElB,YAAYC,GAAZ,CApBF,CAAP;AAqBD;;AAED;;;AAGO,SAASF,MAAT,CAAgBS,GAAhB,EAAqBP,GAArB,EAA0B;AAC/B,MAAMS,SAASF,IAAIG,IAAJ,CAASC,GAAxB;AAAA,MACEO,SAASX,IAAIoB,MAAJ,CAAWC,EADtB;AAEA,SAAO,mBAASpB,OAAT,CAAiB,EAAEC,QAAQA,MAAV,EAAjB,EAAqCI,IAArC,GACJC,IADI,CACC,oBAAY;AAChB,QAAMe,QAAQb,SAASK,KAAT,CAAeC,OAAf,CAAuBJ,MAAvB,CAAd;;AAEA,QAAGW,UAAU,CAAC,CAAd,EAAiB;AACf,aAAO7B,IAAIK,MAAJ,CAAW,GAAX,EAAgBU,IAAhB,CAAqB,EAAEK,SAAS,uCAAX,EAArB,CAAP;AACD;;AAEDJ,aAASK,KAAT,CAAeS,MAAf,CAAsBD,KAAtB,EAA6B,CAA7B;AACA,WAAOb,SAASQ,IAAT,EAAP;AACD,GAVI,EAWJV,IAXI,CAWC,YAAM;AACVd,QAAI0B,GAAJ;AACD,GAbI,EAcJT,KAdI,CAcElB,YAAYC,GAAZ,CAdF,CAAP;AAeD","file":"mustread.controller.js","sourcesContent":["'use strict';\n\nimport Mustread from './mustread.model';\n\nfunction handleError(res, statusCode) {\n  statusCode = statusCode || 500;\n  return function(err) {\n    console.log(err);\n    return res.status(statusCode).send(err);\n  };\n}\n\n/**\n * get mustreads by user\n */\nexport function get(req, res) {\n  return Mustread.findOne({ userId: req.user._id })\n    .populate('books')\n    .exec()\n    .then(mustread => {\n      res.json(mustread);\n    })\n    .catch(handleError(res));\n}\n\n/**\n * adds book to mustreads\n */\nexport function add(req, res) {\n  const bookId = req.body.bookId;\n  if(!bookId) {\n    return res.status(400).json({ message: 'Book Not Provided' });\n  }\n\n  return Mustread.findOne({ userId: req.user._id }).exec()\n    .then(mustread => {\n      if(mustread) {\n        if(mustread.books.indexOf(bookId) > -1) {\n          return res.status(400).json({ message: 'Book is already in Must Read Titles' });\n        }\n\n        mustread.books.push(bookId);\n        return mustread.save();\n      } else {\n        let newMustread = new Mustread({\n          userId: req.user._id,\n          books: [bookId]\n        });\n        return newMustread.save();\n      }\n    })\n    .then(() => {\n      res.end();\n    })\n    .catch(handleError(res));\n}\n\n/**\n * removes book from mustreads\n */\nexport function remove(req, res) {\n  const userId = req.user._id,\n    bookId = req.params.id;\n  return Mustread.findOne({ userId: userId }).exec()\n    .then(mustread => {\n      const index = mustread.books.indexOf(bookId);\n\n      if(index === -1) {\n        return res.status(400).json({ message: 'Book Not Found in Your Must Read List' });\n      }\n\n      mustread.books.splice(index, 1);\n      return mustread.save();\n    })\n    .then(() => {\n      res.end();\n    })\n    .catch(handleError(res));\n}\n"]}